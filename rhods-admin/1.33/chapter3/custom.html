<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Create a Custom Notebook Image :: Red Hat OpenShift Data Science Administration</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="importcustom.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat OpenShift Data Science Administration</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhods-admin/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhods-admin" data-version="1.33">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat OpenShift Data Science Administration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Installation of Red&#160;Hat Openshift Data Science</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/install-general-info.html">General Information about Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/dependencies-install-web-console.html">Installing Dependencies Using the Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/rhods-install-web-console.html">Installation Red&#160;Hat Openshift Data Science Using the Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/olm-overview.html">Introduction to CLI-based operator installations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/dependencies-install-cli.html">Installing Dependencies Using the CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/rhods-install-cli.html">Installation Red&#160;Hat Openshift Data Science Using the Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/upgrading-rhods.html">Upgrading Red&#160;Hat Openshift Data Science</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/uninstalling-rhods.html">Uninstalling Red&#160;Hat Openshift Data Science</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Controlling User Access and Managing Resources</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/users.html">Users, Projects, and Permissions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/resources.html">Managing Resources</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Building Custom Notebook Images</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="custom.html">Create a Custom Notebook Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="importcustom.html">Importing Custom Notebook Images</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat OpenShift Data Science Administration</span>
    <span class="version">1.33</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat OpenShift Data Science Administration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.33</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat OpenShift Data Science Administration</a></li>
    <li><a href="index.html">Building Custom Notebook Images</a></li>
    <li><a href="custom.html">Create a Custom Notebook Image</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Create a Custom Notebook Image</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Custom notebook images allow you to add specific packages and libraries for your projects. This level of customization provides you with a consistent development environment for your teams to work in and ensures that your projects are reproducible between team members. You may also want to create custom notebooks that are more secure than the default notebook image provided in OpenShift AI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_image_source_and_pre_built_images"><a class="anchor" href="#_image_source_and_pre_built_images"></a>Image source and Pre-built images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default OpenShift AI notebook images can be found in the <a href="https://github.com/opendatahub-io/notebooks">Default OpenShift AI notebooks</a> repository. This repository contains the source code, pre-built images, and examples to help you create your own image.</p>
</div>
<div class="paragraph">
<p>Additional images are available at the ODH contributions repository (<a href="https://github.com/opendatahub-io-contrib/workbench-images">opendatahub-io-contrib/workbench-images</a>) This is a place to source additional images, as well as a great resource for best practices for building custom images. Workbench and runtime images are available as well as a script to generate custom images (<a href="https://github.com/opendatahub-io-contrib/workbench-images#building-an-image" class="bare">https://github.com/opendatahub-io-contrib/workbench-images#building-an-image</a>)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise"><a class="anchor" href="#_exercise"></a>Exercise</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will now build our own custom image. We&#8217;ll use <a href="https://quay.io/mmurakam/workbenches:fraud-detection-v1.0.1">Fraud Detection Image</a> as our base image. This image contains artifacts that we will be using later in the course.</p>
</div>
<div class="paragraph">
<p>We will be adding the seaborn python package to the Fraud Detection image. It is a data visualization library based on matplotlib.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>On OpenShift, every containers in a standard namespace (unless you modify security) run with a user with a random user id (uid), and the group id (gid) 0. Therefore, all the folders that you want to write in, and all the files you want to modify (temporarily) in your image must be accessible by this user. The <strong>best practice</strong> is to set the <strong>ownership at 1001:0</strong> (user "default", group "0").</p>
</li>
<li>
<p>If you don&#8217;t want/can&#8217;t do that, another solution is to set permissions properly for any user, like 775.</p>
</li>
<li>
<p>When launching a notebook in OpenShift AI, the working directory of a user is mounted at /opt/app-root/src. This is not configurable, so make sure to build your images with this default location for the data that you want persisted.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>Requirements</h3>
<div class="paragraph">
<p>To build</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Need podman</p>
<div class="ulist">
<ul>
<li>
<p>You could also use buildah, docker, OpenShift BuildConfigs, or a Tekton pipeline, but we&#8217;ll just build the image using podman for this course.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Need an image registry</p>
<div class="ulist">
<ul>
<li>
<p>We&#8217;ll use Quay as our image registry. You can sign up for a free account at <a href="https://quay.io">Quay.io</a> if you don&#8217;t already have one.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_containerfile_overview"><a class="anchor" href="#_containerfile_overview"></a>Containerfile Overview</h3>
<div class="paragraph">
<p>Before you start to edit the Containerfile lets go over what this Containerfile is doing.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Containerfile</dt>
</dl>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>#This is the base image we'll be working from
FROM quay.io/mmurakam/workbenches:fraud-detection-v1.0.1  <i class="conum" data-value="1"></i><b>(1)</b>

# Copying custom packages
# The requirements.txt file contains additional package dependencies we want installed
COPY requirements.txt ./  <i class="conum" data-value="2"></i><b>(2)</b>

# Install packages and cleanup
# (all commands are chained to minimize layer size)
RUN echo "Installing softwares and packages" &amp;&amp; \     <i class="conum" data-value="3"></i><b>(3)</b>
    pip install micropipenv &amp;&amp; \
    # Install Python packages \
    micropipenv install &amp;&amp; \
    rm -f ./requiremnents.txt

# Fix permissions to support pip in Openshift environments \
RUN chmod -R g+w /opt/app-root/lib/python3.9/site-packages &amp;&amp; \    <i class="conum" data-value="4"></i><b>(4)</b>
    fix-permissions /opt/app-root -P</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The FROM command contains the base image that we&#8217;ll be using to build our custom image from. This will already contain common python packages that Data Scientists use and artifacts needed later in the course. Our Fraud Detection image is using <code class="sh">quay.io/modh/cuda-notebooks:cuda-jupyter-tensorflow-ubi9-python-3.9-2023a-20230714-933b52f</code> as the base image. You can find more base images at <a href="https://quay.io/organization/modh" class="bare">https://quay.io/organization/modh</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The COPY command copies a requirements.txt file with the extra package that we will need in our notebook. The requirements.txt file in Python is a text file that lists all the third-party Python packages or libraries that a project depends on. micropipenv is a small footprint alternative to pip that allows us to install packages from our requirements.txt file.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The next step is to install the packages. A lighweight wrapper for pip, micropipenv, allows us to install packages from our requirements.txt file. After the seaborn pacakge is installed we then remove the requirements.txt to clean up the files.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We&#8217;ll fix the permissons to support pip in OpenShift.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_steps"><a class="anchor" href="#_build_steps"></a>Build Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the requirements.txt file under /6.rhod-admin/custom-images.<br>
The only package we&#8217;re installing is seaborn. It&#8217;s a Python data visualization library that we&#8217;ll use in our notebook.</p>
<div class="paragraph">
<p><strong><em>requirements.txt</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">seaborn==0.12.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple packages can be installed with the requirements.txt file by adding them on the next line. For example, the below requirements.txt file would install seaborn and the trino packages.</p>
</div>
<div class="paragraph">
<p><strong><em>requirements.txt</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">seaborn==0.12.2
trino==0.305.0</code></pre>
</div>
</div>
</li>
<li>
<p>Open the Containerfile under /6.rhod-admin/custom-images and add the 2 commands below to the appropriate sections in the Containerfile. Refer to the Containerfile Overview section above to verify the correct location.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">   FROM quay.io/mmurakam/workbenches:fraud-detection-v1.0.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">   COPY requirements.txt ./</code></pre>
</div>
</div>
</li>
<li>
<p>We&#8217;ll now build the image with podman. Open a terminal and go to /6.rhod-admin/custom-images. Run the below command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">podman build -t rhods-custom-image .</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a similar message in the logs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The seaborn package is installed successfully.</p>
<div class="imageblock">
<div class="content">
<img src="_images/podmanSeabornInstalled.png" alt="podmanSeabornInstalled">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Once the image is done building run the below command to make sure the image is in the list.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">podman images</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/podmanImages.png" alt="podmanImages">
</div>
</div>
</li>
<li>
<p>Login to quay.io so we can push the image you just built up to the quay repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">podman login quay.io</code></pre>
</div>
</div>
</li>
<li>
<p>Push the image to your quay repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">podman push rhods-custom-image:latest quay.io/&lt;YOUR_USERNAME&gt;/rhods-custom-image</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now you&#8217;re ready to import your image into OpenShift AI! See the next section to learn how to import your custom image and test it out.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Building Custom Notebook Images</a></span>
  <span class="next"><a href="importcustom.html">Importing Custom Notebook Images</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
